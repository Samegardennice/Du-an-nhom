<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bảng điều khiển Quản trị viên - Green Campus</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}" />
</head>
<body>
  <header>
    <h1>🌿 Green Campus Admin Dashboard</h1>
    <form action="{{ url_for('logout') }}" method="get">
      <button class="logout-btn" type="submit">Đăng xuất</button>
    </form>
  </header>

  <main class="dashboard">
    <!-- 📊 Khu vực thống kê -->
    <section class="cards">
      <div class="card">
        <h3>👥 Người dùng</h3>
        <p class="number">{{ total_users }}</p>
        <p class="desc">Tổng số người dùng đã đăng ký</p>
      </div>
      <div class="card">
        <h3>🌱 Hành động xanh</h3>
        <p class="number">{{ total_images_all }}</p>
        <p class="desc">Tổng số hành động xanh đã ghi nhận từ người dùng</p>
      </div>
      <div class="card">
        <h3>✅ Đã xác nhận</h3>
        <p class="number">{{ total_images_approved }}</p>
        <p class="desc">Hành động xanh được duyệt</p>
      </div>
    </section>
    
    <!-- 📅 Đếm số hoạt động đã duyệt trong ngày -->
    <section class="count-section">
      <h2>📅 Thống kê hoạt động xanh theo ngày</h2>
      <form method="POST" action="{{ url_for('admin_dashboard') }}">
        <label for="selected_date">Chọn ngày:</label>
        <input type="date" id="selected_date" name="selected_date" required>
        <button type="submit">Xem</button>
      </form>

      {% if selected_date %}
      <p class="result">
        Ngày <b>{{ selected_date }}</b> có 
        <b>{{ count_by_date or 0 }}</b> hoạt động được duyệt ✅
      </p>
      {% endif %}
    </section>

    <!-- 👤 Danh sách người dùng -->
    <section class="user-section">
      <h2>👤 Danh sách người dùng</h2>
      <table>
        <thead>
          <tr>
            <th>Tên</th>
            <th>Email</th>
            <th>Địa chỉ</th>
            <th>SĐT</th>
            <th>Vai trò</th>
          </tr>
        </thead>
        <tbody>
          {% for u in users %}
          <tr>
            <td>{{ u.username }}</td>
            <td>{{ u.email }}</td>
            <td>{{ u.address or '-' }}</td>
            <td>{{ u.phone or '-' }}</td>
            <td>{{ u.role }}</td>
          </tr>
          {% else %}
          <tr><td colspan="5" style="text-align:center;">Không có người dùng nào.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </section>

    <!-- 🌍 Hành động xanh chờ xác nhận -->
    <section class="action-section">
      <h2>🌍 Hành động xanh chờ xác nhận</h2>
      <table>
        <thead>
          <tr>
            <th>Người dùng</th>
            <th>Mô tả hành động</th>
            <th>Ảnh minh chứng</th>
            <th>Ngày gửi</th>
            <th>Thao tác</th>
          </tr>
        </thead>
        <tbody>
          {% for img in pending_images %}
          <tr>
            <td>{{ img.username }}</td>
            <td>{{ img.caption }}</td>
            <td>
              <img src="{{ url_for('uploaded_file', filename=img.image_path.split('/')[-1]) }}" 
                   alt="ảnh hành động" width="120" />
            </td>
            <td>{{ img.created_at }}</td>
            <td>
              <form action="{{ url_for('approve_photo', image_id=img.id) }}" method="post" style="display:inline;">
                <button class="approve" type="submit">✔ Duyệt</button>
              </form>
              <form action="{{ url_for('reject_photo', image_id=img.id) }}" method="post" style="display:inline;">
                <button class="reject" type="submit">✖ Từ chối</button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr><td colspan="5" style="text-align:center;">Không có hành động nào đang chờ duyệt.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </section>
  </main>
</body>
</html>